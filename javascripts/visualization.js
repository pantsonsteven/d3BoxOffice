var juneData = [
   {"date":"06/01/14","movie":"Maleficent","sales":19383198 },
   {"date":"06/01/14","movie":"X-Men: Days of Future Past","sales":9339859 },
   {"date":"06/01/14","movie":"A Million Ways to Die in The West","sales":4231615 },
   {"date":"06/01/14","movie":"Godzilla","sales":3417587 },
   {"date":"06/01/14","movie":"Neighbors","sales":2129605 },
   {"date":"06/02/14","movie":"Maleficent","sales":6207742 },
   {"date":"06/02/14","movie":"X-Men: Days of Future Past","sales":3163908 },
   {"date":"06/02/14","movie":"A Million Ways to Die in The West","sales":1627855 },
   {"date":"06/02/14","movie":"Godzilla","sales":1152979 },
   {"date":"06/02/14","movie":"Neighbors","sales":911525 },
   {"date":"06/03/14","movie":"Maleficent","sales":7196208 },
   {"date":"06/03/14","movie":"X-Men: Days of Future Past","sales":3787895 },
   {"date":"06/03/14","movie":"A Million Ways to Die in The West","sales":1864635 },
   {"date":"06/03/14","movie":"Godzilla","sales":1370135 },
   {"date":"06/03/14","movie":"Neighbors","sales":1059450 },
   {"date":"06/04/14","movie":"Maleficent","sales":5612603 },
   {"date":"06/04/14","movie":"X-Men: Days of Future Past","sales":2824137 },
   {"date":"06/04/14","movie":"A Million Ways to Die in The West","sales":1419590 },
   {"date":"06/04/14","movie":"Godzilla","sales":1117001 },
   {"date":"06/04/14","movie":"Neighbors","sales":897550 },
   {"date":"06/05/14","movie":"Maleficent","sales":5399117 },
   {"date":"06/05/14","movie":"X-Men: Days of Future Past","sales":2605125 },
   {"date":"06/05/14","movie":"A Million Ways to Die in The West","sales":1280505 },
   {"date":"06/05/14","movie":"Godzilla","sales":1013205 },
   {"date":"06/05/14","movie":"Neighbors","sales":765605 },
   {"date":"06/06/14","movie":"The Fault in Our Stars","sales":26062046 },
   {"date":"06/06/14","movie":"Edge of Tomorrow","sales":10605165 },
   {"date":"06/06/14","movie":"Maleficent","sales":10189870 },
   {"date":"06/06/14","movie":"X-Men: Days of Future Past","sales":4510017 },
   {"date":"06/06/14","movie":"A Million Ways to Die in The West","sales":2260790 },
   {"date":"06/07/14","movie":"Maleficent","sales":13463278 },
   {"date":"06/07/14","movie":"The Fault in Our Stars","sales":12680655 },
   {"date":"06/07/14","movie":"Edge of Tomorrow","sales":10474234 },
   {"date":"06/07/14","movie":"X-Men: Days of Future Past","sales":6176540 },
   {"date":"06/07/14","movie":"A Million Ways to Die in The West","sales":2908685 },
   {"date":"06/08/14","movie":"Maleficent","sales":10675116 },
   {"date":"06/08/14","movie":"The Fault in Our Stars","sales":9259822 },
   {"date":"06/08/14","movie":"Edge of Tomorrow","sales":7680847 },
   {"date":"06/08/14","movie":"X-Men: Days of Future Past","sales":4468257 },
   {"date":"06/08/14","movie":"A Million Ways to Die in The West","sales":2179020 },
   {"date":"06/09/14","movie":"The Fault in Our Stars","sales":5095488 },
   {"date":"06/09/14","movie":"Maleficent","sales":4047865 },
   {"date":"06/09/14","movie":"Edge of Tomorrow","sales":3167460 },
   {"date":"06/09/14","movie":"X-Men: Days of Future Past","sales":1765307 },
   {"date":"06/09/14","movie":"A Million Ways to Die in The West","sales":917935 },
   {"date":"06/10/14","movie":"The Fault in Our Stars","sales":5002851 },
   {"date":"06/10/14","movie":"Maleficent","sales":4712585 },
   {"date":"06/10/14","movie":"Edge of Tomorrow","sales":3482263 },
   {"date":"06/10/14","movie":"X-Men: Days of Future Past","sales":2021629 },
   {"date":"06/10/14","movie":"A Million Ways to Die in The West","sales":1058440 },
   {"date":"06/11/14","movie":"The Fault in Our Stars","sales":4168922 },
   {"date":"06/11/14","movie":"Maleficent","sales":3986901 },
   {"date":"06/11/14","movie":"Edge of Tomorrow","sales":2772354 },
   {"date":"06/11/14","movie":"X-Men: Days of Future Past","sales":1707464 },
   {"date":"06/11/14","movie":"A Million Ways to Die in The West","sales":914865 },
   {"date":"06/12/14","movie":"The Fault in Our Stars","sales":3705483 },
   {"date":"06/12/14","movie":"Maleficent","sales":3593949 },
   {"date":"06/12/14","movie":"Edge of Tomorrow","sales":2292160 },
   {"date":"06/12/14","movie":"X-Men: Days of Future Past","sales":1389681 },
   {"date":"06/12/14","movie":"A Million Ways to Die in The West","sales":630915 },
   {"date":"06/13/14","movie":"22 Jump Street","sales":25144490 },
   {"date":"06/13/14","movie":"How to Train Your Dragon 2","sales":18440040 },
   {"date":"06/13/14","movie":"The Fault in Our Stars","sales":6359826 },
   {"date":"06/13/14","movie":"Maleficent","sales":5848429 },
   {"date":"06/13/14","movie":"Edge of Tomorrow","sales":4581413 },
   {"date":"06/14/14","movie":"22 Jump Street","sales":18726869 },
   {"date":"06/14/14","movie":"How to Train Your Dragon 2","sales":17315466 },
   {"date":"06/14/14","movie":"Maleficent","sales":7311521 },
   {"date":"06/14/14","movie":"Edge of Tomorrow","sales":6108727 },
   {"date":"06/14/14","movie":"The Fault in Our Stars","sales":5741160 },
   {"date":"06/15/14","movie":"How to Train Your Dragon 2","sales":13695816 },
   {"date":"06/15/14","movie":"22 Jump Street","sales":13200086 },
   {"date":"06/15/14","movie":"Edge of Tomorrow","sales":5837075 },
   {"date":"06/15/14","movie":"Maleficent","sales":5345047 },
   {"date":"06/15/14","movie":"X-Men: Days of Future Past","sales":3360831 },
   {"date":"06/16/14","movie":"22 Jump Street","sales":6830926 },
   {"date":"06/16/14","movie":"How to Train Your Dragon 2","sales":5056288 },
   {"date":"06/16/14","movie":"The Fault in Our Stars","sales":2307777 },
   {"date":"06/16/14","movie":"Maleficent","sales":2269929 },
   {"date":"06/16/14","movie":"Edge of Tomorrow","sales":1672018 },
   {"date":"06/17/14","movie":"22 Jump Street","sales":7348908 },
   {"date":"06/17/14","movie":"How to Train Your Dragon 2","sales":5905504 },
   {"date":"06/17/14","movie":"Maleficent","sales":2841610 },
   {"date":"06/17/14","movie":"The Fault in Our Stars","sales":2641279 },
   {"date":"06/17/14","movie":"Edge of Tomorrow","sales":2083413 },
   {"date":"06/18/14","movie":"22 Jump Street","sales":5774371 },
   {"date":"06/18/14","movie":"How to Train Your Dragon 2","sales":4778724 },
   {"date":"06/18/14","movie":"Maleficent","sales":2393514 },
   {"date":"06/18/14","movie":"The Fault in Our Stars","sales":2233298 },
   {"date":"06/18/14","movie":"Edge of Tomorrow","sales":1711035 },
   {"date":"06/19/14","movie":"22 Jump Street","sales":5424480 },
   {"date":"06/19/14","movie":"How to Train Your Dragon 2","sales":4684897 },
   {"date":"06/19/14","movie":"Maleficent","sales":2441986 },
   {"date":"06/19/14","movie":"The Fault in Our Stars","sales":2178779 },
   {"date":"06/19/14","movie":"Edge of Tomorrow","sales":1703329 },
   {"date":"06/20/14","movie":"Think Like a Man Too","sales":12180056 },
   {"date":"06/20/14","movie":"22 Jump Street","sales":9325176 },
   {"date":"06/20/14","movie":"How to Train Your Dragon 2","sales":7636170 },
   {"date":"06/20/14","movie":"Jersey Boys","sales":4644888 },
   {"date":"06/20/14","movie":"Maleficent","sales":3999121 },
   {"date":"06/21/14","movie":"22 Jump Street","sales":10812737 },
   {"date":"06/21/14","movie":"Think Like a Man Too","sales":10308403 },
   {"date":"06/21/14","movie":"How to Train Your Dragon 2","sales":10066297 },
   {"date":"06/21/14","movie":"Maleficent","sales":5250652 },
   {"date":"06/21/14","movie":"Jersey Boys","sales":5215367 },
   {"date":"06/22/14","movie":"22 Jump Street","sales":7323082 },
   {"date":"06/22/14","movie":"How to Train Your Dragon 2","sales":7016845 },
   {"date":"06/22/14","movie":"Think Like a Man Too","sales":6753452 },
   {"date":"06/22/14","movie":"Maleficent","sales":3660993 },
   {"date":"06/22/14","movie":"Jersey Boys","sales":3459116 },
   {"date":"06/23/14","movie":"22 Jump Street","sales":3638450 },
   {"date":"06/23/14","movie":"How to Train Your Dragon 2","sales":3123254 },
   {"date":"06/23/14","movie":"Think Like a Man Too","sales":2475300 },
   {"date":"06/23/14","movie":"Maleficent","sales":1748844 },
   {"date":"06/23/14","movie":"Jersey Boys","sales":1472498 },
   {"date":"06/24/14","movie":"22 Jump Street","sales":4465576 },
   {"date":"06/24/14","movie":"How to Train Your Dragon 2","sales":4336155 },
   {"date":"06/24/14","movie":"Think Like a Man Too","sales":2559902 },
   {"date":"06/24/14","movie":"Maleficent","sales":2315415 },
   {"date":"06/24/14","movie":"Jersey Boys","sales":1933409 },
   {"date":"06/25/14","movie":"How to Train Your Dragon 2","sales":3524302 },
   {"date":"06/25/14","movie":"22 Jump Street","sales":3492276 },
   {"date":"06/25/14","movie":"Maleficent","sales":1941335 },
   {"date":"06/25/14","movie":"Think Like a Man Too","sales":1862648 },
   {"date":"06/25/14","movie":"Jersey Boys","sales":1604028 },
   {"date":"06/26/14","movie":"22 Jump Street","sales":2929465 },
   {"date":"06/26/14","movie":"Maleficent","sales":1748462 },
   {"date":"06/26/14","movie":"Think Like a Man Too","sales":1628599 },
   {"date":"06/26/14","movie":"Jersey Boys","sales":1403180 },
   {"date":"06/26/14","movie":"The Fault in Our Stars","sales":1352963 },
   {"date":"06/27/14","movie":"22 Jump Street","sales":5135431 },
   {"date":"06/27/14","movie":"How to Train Your Dragon 2","sales":4120789 },
   {"date":"06/27/14","movie":"Think Like a Man Too","sales":3383399 },
   {"date":"06/27/14","movie":"Maleficent","sales":2598651 },
   {"date":"06/27/14","movie":"Jersey Boys","sales":2259438 },
   {"date":"06/28/14","movie":"22 Jump Street","sales":6172211 },
   {"date":"06/28/14","movie":"How to Train Your Dragon 2","sales":5156662 },
   {"date":"06/28/14","movie":"Think Like a Man Too","sales":4258372 },
   {"date":"06/28/14","movie":"Maleficent","sales":3307493 },
   {"date":"06/28/14","movie":"Jersey Boys","sales":3163706 },
   {"date":"06/29/14","movie":"22 Jump Street","sales":4534733 },
   {"date":"06/29/14","movie":"How to Train Your Dragon 2","sales":3960246 },
   {"date":"06/29/14","movie":"Think Like a Man Too","sales":2674626 },
   {"date":"06/29/14","movie":"Maleficent","sales":2470530 },
   {"date":"06/29/14","movie":"Jersey Boys","sales":2289120 },
   {"date":"06/30/14","movie":"Transformers: Age of Extinction","sales":10504274 },
   {"date":"06/30/14","movie":"22 Jump Street","sales":2439968 },
   {"date":"06/30/14","movie":"How to Train Your Dragon 2","sales":2273703 },
   {"date":"06/30/14","movie":"Maleficent","sales":1441486 },
   {"date":"06/30/14","movie":"Think Like a Man Too","sales":1123579 }
];


// structures data according to date
function createDateData(data) {

   // Parses date in data
   var parseDate = d3.time.format("%m/%d/%y").parse;

   //create nested array by date
   var dates = d3.nest()
      .key(function(d) { return d.date })
      .entries(data);

   dates.forEach(function(day) {
      day.key = parseDate(day.key);
      day.maxSales = d3.max(day.values, function(d) {
         return d.sales;
      });
      day.minSales = d3.min(day.values, function(d) {
         return d.sales;
      });
      day.totalSales = d3.sum(day.values, function(d) {
         return d.sales;
      });

   });

   return dates;
}; // End of createDateData


// structures data according to movie
function createMovieData(data) {

   // Parses date in data
   var parseDate = d3.time.format("%m/%d/%y").parse;

   //create nested array by movie
   var movies = d3.nest()
      .key(function(d) { return d.movie })
      .entries(data);

   movies.forEach(function(movie) {
      movie.values.forEach(function(d) { 
          d.date = parseDate(d.date); 
          d.sales = +d.sales;
      });
   movie.maxSales = d3.max(movie.values, function(d) {
      return d.sales;
   });
   movie.minSales = d3.min(movie.values, function(d) {
      return d.sales;
   });
   movie.totalSales = d3.sum(movie.values, function(d) {
      return d.sales;
   });
});

   return movies;
 }; // End of createMovieData


// Appends data to svg
function projectGraph(data) {

   var line = d3.svg.line()
      .x(function(d) { return x(d.date); })
      .y(function(d) { return y(d.sales); })
      .interpolate("cardinal");

   data.forEach(function(movie) {
      window.svg.append('path')
         .attr('class', "line")
         .attr('id', movie.key)
         .attr('d', line(movie.values))
         .attr('stroke-width', 4)
         .style('opacity', .75)
         .attr('stroke', function() { return window.color(Math.ceil((data.indexOf(movie)/data.length)*12)); })
         .attr('fill', 'none');
   });

}; // End of project


// Sets up SVG space
function buildSVG(data) {

   // var dates = createDateData(data);
   var movies = createMovieData(data);

   // console.log(dates)
   console.log(movies)

   var margin  = {
      top      : 100,
      right    : 100,
      bottom   : 100,
      left     : 150
      },
      width    = 1300 - margin.right - margin.left,
      height   = 750 - margin.top - margin.bottom;

   var maxDate = d3.max(movies, function(m) {
      return d3.max(m.values, function(d) {
         return d.date;
      });
   });

   var minDate = d3.min(movies, function(m) {
      return d3.min(m.values, function(d) {
         return d.date;
      });
   });

   var maxSales = d3.max(movies, function(m) {
      return m.maxSales;
   });

   var minSales = d3.min(movies, function(m) {
      return m.minSales;
   });

   window.x = d3.time.scale()
      .range([0, width])
      .domain([minDate, maxDate]);

   window.y = d3.scale.linear()
      .range([height, 0])
      .domain([0, maxSales]);

   var xAxis = d3.svg.axis()
      .scale(window.x)
      .orient('bottom');

   var yAxis = d3.svg.axis()
      .scale(window.y)
      .orient('left');

   window.svg = d3.select('body').append('svg')
         .attr('width', width +  margin.left + margin.right)
         .attr('height', height + margin.top + margin.bottom)
      .append('g')
         .attr('width', width)
         .attr('height', height)
         .attr('class', 'graph')
         .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');
      
   window.svg.append('g')
      .attr('class', 'x axis')
      .attr('transform', 'translate(0,' + height + ')')
      .call(xAxis)
      .append('text')
      .text('Date')
      .attr('x', width/2)
      .attr('y', 50);

   window.svg.append('g')
      .attr('class', 'y axis')
      .call(yAxis)
      .append('text')
      .text('Sales')
      .attr('x', -100)
      .attr('y', height/2);

   // Creates ordinal color scale
   window.color = d3.scale.ordinal()
      .range(colorbrewer.Paired[12]);

   projectGraph(movies);
}; // End of buildSVG



$(function() {
    
   buildSVG(juneData);
  
})




